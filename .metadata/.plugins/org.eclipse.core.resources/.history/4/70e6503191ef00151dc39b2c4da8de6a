package source;

import java.util.HashMap;
import java.util.Map;

public class Threads extends Thread {
	
	public int[] alphabet;
	
	public Threads(int[] alphabetFromPerms)
	{
		alphabet = alphabetFromPerms;
		//for(int i = 0; i < alphabetSomething.length; ++i)
			//System.out.print(alphabetSomething[i]+ " ");
			// !Semaphores and mutexs - Look this up!
	}
	
	public void run()
	{
		boolean done = false;
		
		for(int i = 0; i < indexes.size(); ++i)
		{
			if(perms[i] > maxNumber[i])
			{
				if(i - 1 > 0)
				{
					++perms[i - 1];
					
					for(int j = i; j < indexes.size(); ++j)
					{
						perms[j] = 0;
					}
				}
				i = 0;
			}
			if(perms[i] < minNumber[i])
			{
				
				++perms[i];
				i = 0;
			}
		}
		int[] permsInner = new int[perms.length];
		int[] radicesInner = new int[radices.length];
		
		if(!done)
		{
			for(int i = 0; i < perms.length; ++i)
			{
				if(perms[i] >= 5)
				{
					perms[i] = 4;
				}
				radicesInner[i] = frequencyStrings[perms[i]].length();
			}
		}
		
		//Permutates over the letters of the alphabet
		while(!done)
		{	
			Map<Integer, String> contained = new HashMap<Integer, String>();
			boolean passed = true;
			
			for(int i = 0; i < radicesInner.length; ++i)
			{
				if(!contained.containsValue(Character.toString(frequencyStrings[perms[i]].charAt(permsInner[i]))))
				{
					//EMPTY - TODO FIND A WAY TO SPEED UP PERMUTATION TIME -- THOUGH THIS MAY BE THE FASTEST IT GETS....
				}
				else
				{
					passed = false;
					break;
				}
				contained.put(i, Character.toString(frequencyStrings[perms[i]].charAt(permsInner[i])));
			}
			
			if(passed == true)
			{
				String tempStr = "";
				for(int i = 0; i < contained.size(); ++i)
				{
					tempStr += contained.get(i);
				}
				
				if(!alphabetContained.containsValue(tempStr))
				{
					Alphabet alphabet = new Alphabet();
					String tempStringLetters = "L -> ";
					String actualLettersUsed = "";
					
					for(int i = 0; i < permsInner.length; ++i)
					{
						tempStringLetters += permsInner[i] + "-";
						
						int[] indexOfAlphabet = ADFGX.getAlphabetIndexFromCharacters(letterPairs[i]);
						alphabet.alphabet[indexOfAlphabet[0]][indexOfAlphabet[1]] = Character.toString(frequencyStrings[perms[i]].charAt(permsInner[i]));
						actualLettersUsed += alphabet.alphabet[indexOfAlphabet[0]][indexOfAlphabet[1]];
					}
					
					String tempStringAlphabet = "A -> "; 
					for(int i = 0; i < perms.length; ++i)
					{
						tempStringAlphabet += perms[i] + "-";
					}
					ADFGX.constructPhrase(alphabet.alphabet, writer, tempStringAlphabet, tempStringLetters, actualLettersUsed);
					
					alphabetContained.put(counter, tempStr);
					++counter;
				}
			}
			
			permsInner[0] += 1;
		    if (permsInner[0] >= radicesInner[0])
		    {
		      int radixsub = 0;
		      while (radicesInner[radixsub] <= permsInner[radixsub])
		      {
		    	permsInner[radixsub] = 0;
		        radixsub += 1;
		        if (radixsub >= radicesInner.length)
		        {
		        	done = true;
		            break;
		        } // if (radixsub >= perms.size())
		        permsInner[radixsub] += 1;
		      } // while (perms.at(radixsub) == limitOfPermutations)
		      
		    } // if (perms.at(0) == limitOfPermutations)
		    
		}
	}
}
